var RESULT={HIT:0,MISS:1,DODGE:2,CRIT:3,GLANCE:4},RESULT2STR={};for(const[e,s]of Object.entries(RESULT))RESULT2STR[s]=e;var DEFENSETYPE={NONE:0,MAGIC:1,MELEE:2,RANGED:3},SCHOOL={NONE:0,PHYSICAL:1,HOLY:2,FIRE:4,NATURE:8,FROST:16,SHADOW:32,ARCANE:64},batching=0,step=0,version=4;const TYPE={UPDATE:0,FINISHED:1,ERROR:2};class SimulationWorker{constructor(e,s,a){this.worker=new Worker("./dist/js/sim-worker.min.js"),this.worker.onerror=((...e)=>{a(...e),this.worker.terminate()}),this.worker.onmessage=(t=>{const[r,...l]=t.data;switch(r){case TYPE.UPDATE:s(...l);break;case TYPE.FINISHED:e(...l),this.worker.terminate();break;case TYPE.ERROR:a(...l),this.worker.terminate();break;default:a(`Unexpected type: ${r}`),this.worker.terminate()}})}start(e){e.globals=getGlobalsDelta(),this.worker.postMessage(e)}}class SimulationWorkerParallel{constructor(e,s,a,t){this.threads=e,this.callback_finished=s,this.callback_update=a,this.states=[...Array(this.threads)],this.workers=this.states.map((e,s)=>new SimulationWorker(e=>{this.states[s]={status:1,data:e},this.update()},(e,a)=>{this.states[s]={status:0,iteration:e,data:a},this.update()},e=>{this.error||(this.error=e,t(e))}))}update(){if(this.error)return;if(this.states.reduce((e,s)=>e+(s&&s.status||0),0)>=this.states.length){const e=this.states[0].data;this.states.slice(1).forEach(({data:s})=>{if(e.iterations+=s.iterations,e.totaldmg+=s.totaldmg,e.totalduration+=s.totalduration,e.mindps=Math.min(e.mindps,s.mindps),e.maxdps=Math.min(e.maxdps,s.maxdps),e.sumdps+=s.sumdps,e.sumdps2+=s.sumdps2,e.starttime=Math.min(e.starttime,s.starttime),e.endtime=Math.min(e.endtime,s.endtime),e.spread&&s.spread)for(let a in s.spread)e.spread[a]=(e.spread[a]||0)+s.spread[a];if(e.player&&s.player){for(let a in s.player.auras){const t=s.player.auras[a],r=e.player.auras[a];if(r){if(r.uptime+=t.uptime,t.data)for(let e=0;e<t.data.length;++e)r.data[e]+=t.data[e];t.totaldmg&&(r.totaldmg=(r.totaldmg||0)+t.totaldmg)}else e.player.auras[a]=t}for(let a in s.player.spells){const t=s.player.spells[a],r=e.player.spells[a];if(r){r.totaldmg+=t.totaldmg;for(let e=0;e<t.data.length;++e)r.data[e]+=t.data[e]}else e.player.spells[a]=t}function a(e,s){if(e){e.totaldmg+=s.totaldmg,e.totalprocdmg+=s.totalprocdmg;for(let a=0;a<s.data.length;++a)e.data[a]+=s.data[a];return e}return s}e.player.mh=a(e.player.mh,s.player.mh),s.player.oh&&(e.player.oh=a(e.player.oh,s.player.oh))}}),this.callback_finished(e)}else{let e=0;const s={iterations:this.iterations,totaldmg:0,totalduration:0};this.states.forEach(a=>{a&&(e+=a.status?a.data.iterations:a.iteration,s.totaldmg+=a.data.totaldmg,s.totalduration+=a.data.totalduration)}),this.callback_update(e,s)}}start(e){e.globals=getGlobalsDelta(),this.iterations=e.sim.iterations;let s=e.sim.iterations;this.workers.forEach((a,t)=>{const r=Math.round(s/(this.workers.length-t));s-=r,e.player[3].logging=0==t&&e.fullReport,a.start({...e,sim:{...e.sim,iterations:r}})})}}class Simulation{static getConfig(){return{timesecsmin:parseInt($('input[name="timesecsmin"]').val()),timesecsmax:parseInt($('input[name="timesecsmax"]').val()),executeperc:parseInt($('input[name="executeperc"]').val()),startrage:parseInt($('input[name="startrage"]').val()),iterations:parseInt($('input[name="simulations"]').val()),batching:parseInt($('select[name="batching"]').val())}}constructor(e,s,a,t){t||(t=Simulation.getConfig()),this.player=e,this.timesecsmin=t.timesecsmin,this.timesecsmax=t.timesecsmax,this.executeperc=t.executeperc,this.startrage=t.startrage,this.iterations=t.iterations,batching=t.batching,this.idmg=0,this.totaldmg=0,this.totalduration=0,this.mindps=99999,this.maxdps=0,this.sumdps=0,this.sumdps2=0,this.maxcallstack=Math.min(Math.floor(this.iterations/10),1e3),this.starttime=0,this.endtime=0,this.cb_update=a,this.cb_finished=s,this.spread=[]}startSync(){let e;for(this.starttime=(new Date).getTime(),e=1;e<=this.iterations;++e)this.run(),e%this.maxcallstack==0&&this.update(e);this.endtime=(new Date).getTime(),this.finished()}startAsync(){this.starttime=(new Date).getTime(),this.runAsync(1)}runAsync(e){this.run(),e==this.iterations?(this.endtime=(new Date).getTime(),this.finished()):e%this.maxcallstack==0?(this.update(e),setTimeout(()=>this.runAsync(e+1),0)):this.runAsync(e+1)}run(){step=0,this.idmg=0;let e,s,a=this.player;a.reset(this.startrage),this.maxsteps=rng(1e3*this.timesecsmin,1e3*this.timesecsmax),this.duration=this.maxsteps/1e3,this.executestep=this.maxsteps-parseInt(this.maxsteps*(this.executeperc/100)),a.spells.execute&&(a.spells.execute.executestep=this.executestep);let t=!1,r=!1,l=0,i=0,p=0;for(let e of a.preporder)e.aura?p+=a.auras[e.classname.toLowerCase()].prep(this.maxsteps,p):a.spells[e.classname.toLowerCase()].prep&&a.spells[e.classname.toLowerCase()].prep(this.maxsteps);let o=[];for(let e of Object.values(a.auras))e.usestep<0&&o.push(e);o.sort((e,s)=>s.usestep-e.usestep);let u=1500;for(let e of o)e.canUse()&&(e.use(!1,u),u+=1500,this.player.timer=0,this.player.itemtimer=0);for(a.auras.battleshout&&a.auras.battleshout.use(!0),this.player.timer=0;step<this.maxsteps;){if(0!=l&&step%3e3==0&&a.talents.angermanagement&&(a.rage=a.rage>=99?100:a.rage+1,t=!0,a.auras.consumedrage&&a.rage>=60&&a.rage<81&&a.auras.consumedrage.use()),a.vaelbuff&&0!=l&&step%1e3==0&&(a.rage=a.rage>=60?100:a.rage+20,t=!0,a.auras.consumedrage&&a.rage>=60&&a.auras.consumedrage.use()),a.spells.themoltencore&&0!=l&&step%2e3==0&&a.spells.themoltencore.use(),a.target.speed&&step%a.target.speed==0){let e=a.rage,s=rng(a.target.mindmg,a.target.maxdmg),r=s/a.rageconversion*2.5;a.rage=Math.min(a.rage+r,100),t=!0,a.auras.consumedrage&&a.rage>=60&&e<60&&a.auras.consumedrage.use(),a.logging&&this.player.log(`Target attack for ${s} gained ${r.toFixed(2)} rage `)}if(!i){if(a.mh.timer<=0&&(this.idmg+=a.attackmh(a.mh),t=!0),a.oh&&a.oh.timer<=0&&(this.idmg+=a.attackoh(a.oh),t=!0),t&&!a.spelldelay){if(a.auras.swarmguard&&a.auras.swarmguard.canUse())a.spelldelay=1,e=a.auras.swarmguard;else if(a.auras.mightyragepotion&&a.auras.mightyragepotion.canUse())a.spelldelay=1,e=a.auras.mightyragepotion;else if(a.auras.quicknesspotion&&a.auras.quicknesspotion.canUse())a.spelldelay=1,e=a.auras.quicknesspotion;else if(a.auras.bloodlust&&a.auras.bloodlust.canUse())a.spelldelay=1,e=a.auras.bloodlust;else if(a.spells.ragepotion&&a.spells.ragepotion.canUse())a.spelldelay=1,e=a.spells.ragepotion;else if(a.spells.fireball&&a.spells.fireball.canUse())a.spelldelay=1,e=a.spells.fireball;else if(a.spells.gunaxe&&a.spells.gunaxe.canUse())a.spelldelay=1,e=a.spells.gunaxe;else if(a.auras.mildlyirradiated&&a.auras.mildlyirradiated.canUse())a.spelldelay=1,e=a.auras.mildlyirradiated;else if(a.auras.jujuflurry&&a.auras.jujuflurry.canUse())a.spelldelay=1,e=a.auras.jujuflurry;else if(a.spells.grilekfury&&a.spells.grilekfury.canUse())a.spelldelay=1,e=a.spells.grilekfury;else if(!a.timer&&a.spells.berserkerrage&&a.spells.berserkerrage.zerkerpriority&&a.spells.berserkerrage.canUse())a.spelldelay=1,e=a.spells.berserkerrage;else if(a.spells.bloodrage&&a.spells.bloodrage.canUse())a.spelldelay=1,e=a.spells.bloodrage;else if(a.auras.rampage&&a.auras.rampage.canUse())a.spelldelay=1,e=a.auras.rampage;else if(a.auras.cloudkeeper&&a.auras.cloudkeeper.canUse())a.spelldelay=1,e=a.auras.cloudkeeper;else if(a.auras.hategrips&&a.auras.hategrips.canUse())a.spelldelay=1,e=a.auras.hategrips;else if(a.auras.worgenmark&&a.auras.worgenmark.canUse())a.spelldelay=1,e=a.auras.worgenmark;else if(a.auras.voidmadness&&a.auras.voidmadness.canUse())a.spelldelay=1,e=a.auras.voidmadness;else if(a.auras.gyromaticacceleration&&a.auras.gyromaticacceleration.canUse())a.spelldelay=1,e=a.auras.gyromaticacceleration;else if(a.auras.gneurological&&a.auras.gneurological.canUse())a.spelldelay=1,e=a.auras.gneurological;else if(a.auras.coinflip&&a.auras.coinflip.canUse())a.spelldelay=1,e=a.auras.coinflip;else if(a.auras.pummeler&&a.auras.pummeler.canUse())a.spelldelay=1,e=a.auras.pummeler;else if(a.auras.slayer&&a.auras.slayer.canUse())a.spelldelay=1,e=a.auras.slayer;else if(a.auras.spider&&a.auras.spider.canUse())a.spelldelay=1,e=a.auras.spider;else if(a.auras.gabbar&&a.auras.gabbar.canUse())a.spelldelay=1,e=a.auras.gabbar;else if(a.auras.earthstrike&&a.auras.earthstrike.canUse())a.spelldelay=1,e=a.auras.earthstrike;else if(a.auras.roarguardian&&a.auras.roarguardian.canUse())a.spelldelay=1,e=a.auras.roarguardian;else if(a.auras.zandalarian&&a.auras.zandalarian.canUse())a.spelldelay=1,e=a.auras.zandalarian;else if(a.auras.relentlessstrength&&a.auras.relentlessstrength.canUse())a.spelldelay=1,e=a.auras.relentlessstrength;else if(a.auras.demontaintedblood&&a.auras.demontaintedblood.canUse())a.spelldelay=1,e=a.auras.demontaintedblood;else if(a.auras.wrathwray&&a.auras.wrathwray.canUse())a.spelldelay=1,e=a.auras.wrathwray;else if(a.auras.moonstalkerfury&&a.auras.moonstalkerfury.canUse())a.spelldelay=1,e=a.auras.moonstalkerfury;else if(a.auras.grilekguard&&a.auras.grilekguard.canUse())a.spelldelay=1,e=a.auras.grilekguard;else if(a.spells.unstoppablemight&&a.spells.unstoppablemight.canUse())a.spelldelay=1,e=a.spells.unstoppablemight;else if(a.spells.stanceswitch.canUse())a.spelldelay=1,e=a.spells.stanceswitch;else if(a.timer);else if(a.spells.victoryrush&&a.spells.victoryrush.canUse())a.spelldelay=1,e=a.spells.victoryrush;else if(a.auras.flask&&a.auras.flask.canUse())a.spelldelay=1,e=a.auras.flask;else if(a.auras.recklessness&&a.auras.recklessness.canUse())a.spelldelay=1,e=a.auras.recklessness;else if(a.auras.deathwish&&a.auras.deathwish.canUse())a.spelldelay=1,e=a.auras.deathwish;else if(a.auras.bloodfury&&a.auras.bloodfury.canUse())a.spelldelay=1,e=a.auras.bloodfury;else if(a.auras.berserking&&a.auras.berserking.canUse())a.spelldelay=1,e=a.auras.berserking;else if(a.spells.berserkerrage&&a.spells.berserkerrage.canUse())a.spelldelay=1,e=a.spells.berserkerrage;else if(a.auras.battleshout&&a.auras.battleshout.canUse())a.spelldelay=1,e=a.auras.battleshout;else if(a.spells.blademasterfury&&a.spells.blademasterfury.canUse())a.spelldelay=1,e=a.spells.blademasterfury;else if(a.auras.consumedrage&&a.auras.consumedrage.procblock&&!a.auras.consumedrage.timer&&a.rage<60);else if(a.auras.consumedrage&&a.auras.consumedrage.rageblock&&a.rage<a.auras.consumedrage.rageblock);else if(a.auras.consumedrage&&a.auras.consumedrage.chargeblock&&a.auras.consumedrage.stacks<a.auras.consumedrage.chargeblock&&a.rage<60);else if(step>=this.executestep){for(let s=0;s<a.executespells_c;s++)if(a.executespells[s].canUse()){a.spelldelay=1,e=a.executespells[s];break}}else for(let s=0;s<a.normalspells_c;s++)if(a.normalspells[s].canUse()){a.spelldelay=1,e=a.normalspells[s];break}a.heroicdelay&&(t=!1)}if(t&&!a.heroicdelay&&(a.spells.execute&&(!(step<this.executestep)||a.auras.suddendeath&&a.auras.suddendeath.timer)||a.auras.consumedrage&&a.auras.consumedrage.procblock&&!a.auras.consumedrage.timer&&a.rage<60||a.auras.consumedrage&&a.auras.consumedrage.rageblock&&a.rage<a.auras.consumedrage.rageblock||a.auras.consumedrage&&a.auras.consumedrage.chargeblock&&a.auras.consumedrage.stacks<a.auras.consumedrage.chargeblock&&a.rage<60||(a.spells.heroicstrike&&a.spells.heroicstrike.canUse()?(a.heroicdelay=1,s=a.spells.heroicstrike):a.spells.cleave&&a.spells.cleave.canUse()&&(a.heroicdelay=1,s=a.spells.cleave)),t=!1),a.spelldelay&&e&&(r||a.spelldelay>e.maxdelay))if(a.heroicdelay&&s&&a.heroicdelay>s.maxdelay&&(a.heroicdelay=s.maxdelay-99),e.canUse()){if(e instanceof Slam){i=step+e.casttime,a.freeslam&&(i=step),a.timer=1500,a.heroicdelay=0,a.nextswinghs=!1,l=0,a.logging&&this.player.log("Casting Slam");continue}let r=a.cast(e,s);if(this.idmg+=r,a.spelldelay=0,t=!0,e.offhandhit&&a.oh&&(r=a.castoh(e),this.idmg+=r),e instanceof Whirlwind||e instanceof BlademasterFury||e instanceof ThunderClap||e instanceof Shockwave)for(let t=0;t<a.adjacent;t++)r=a.cast(e,s,a.adjacent,r),this.idmg+=r,e.offhandhit&&a.oh&&(r=a.castoh(e,a.adjacent,r),this.idmg+=r)}else a.spelldelay=0;a.heroicdelay&&s&&a.heroicdelay>s.maxdelay&&(s.canUse()?(a.cast(s),a.heroicdelay=0,t=!0):a.heroicdelay=0),a.spells.execute&&(!(step<this.executestep)||a.auras.suddendeath&&a.auras.suddendeath.timer)||(a.spells.heroicstrike&&a.spells.heroicstrike.unqueue&&a.nextswinghs&&a.rage<a.spells.heroicstrike.unqueue&&a.mh.timer<=a.spells.heroicstrike.unqueuetimer?(this.player.nextswinghs=!1,a.logging&&this.player.log("Heroic Strike unqueued")):a.spells.cleave&&a.spells.cleave.unqueue&&a.nextswinghs&&a.rage<a.spells.cleave.unqueue&&a.mh.timer<=a.spells.cleave.unqueuetimer&&(this.player.nextswinghs=!1,a.logging&&this.player.log("Cleave unqueued")))}if(i&&step==i){let r=a.cast(e,s);this.idmg+=r,e.offhandhit&&a.oh&&(r=a.castoh(e),this.idmg+=r),t=!0,i=0}if(a.extraattacks>0&&(a.mh.timer=0,a.extraattacks--),a.batchedextras>0&&(a.mh.timer=batching-step%batching,a.batchedextras--),i)l=i-step;else{if(!a.mh.timer||!a.spelldelay&&t||!a.heroicdelay&&t){l=0;continue}l=Math.min(a.mh.timer,a.oh?a.oh.timer:9999),a.spelldelay&&e.maxdelay-a.spelldelay<l&&(l=e.maxdelay-a.spelldelay+1),a.heroicdelay&&s.maxdelay-a.heroicdelay<l&&(l=s.maxdelay-a.heroicdelay+1)}if(a.timer&&a.timer<l&&(l=a.timer),a.itemtimer&&a.itemtimer<l&&(l=a.itemtimer),a.stancetimer&&a.stancetimer<l&&(l=a.stancetimer),a.ragetimer&&a.ragetimer<l&&(l=a.ragetimer),a.target.speed&&a.target.speed-step%a.target.speed<l&&(l=a.target.speed-step%a.target.speed),a.talents.angermanagement&&3e3-step%3e3<l&&(l=3e3-step%3e3),a.vaelbuff&&1e3-step%1e3<l&&(l=1e3-step%1e3),a.spells.themoltencore&&2e3-step%2e3<l&&(l=2e3-step%2e3),a.auras.bloodrage&&a.auras.bloodrage.timer&&1e3-(step-a.auras.bloodrage.starttimer)%1e3<l&&(l=1e3-(step-a.auras.bloodrage.starttimer)%1e3),a.auras.gabbar&&a.auras.gabbar.timer&&2e3-(step-a.auras.gabbar.starttimer)%2e3<l&&(l=2e3-(step-a.auras.gabbar.starttimer)%2e3),a.auras.rend&&a.auras.rend.timer&&3e3-(step-a.auras.rend.starttimer)%3e3<l&&(l=3e3-(step-a.auras.rend.starttimer)%3e3),a.auras.deepwounds&&a.auras.deepwounds.timer&&a.auras.deepwounds.nexttick-step<l&&(l=a.auras.deepwounds.nexttick-step),a.auras.potentvenoms&&a.auras.potentvenoms.timer&&a.auras.potentvenoms.nexttick-step<l&&(l=a.auras.potentvenoms.nexttick-step),a.adjacent&&(a.auras.deepwounds2&&a.auras.deepwounds2.timer&&a.auras.deepwounds2.nexttick-step<l&&(l=a.auras.deepwounds2.nexttick-step),a.auras.deepwounds3&&a.auras.deepwounds3.timer&&a.auras.deepwounds3.nexttick-step<l&&(l=a.auras.deepwounds3.nexttick-step),a.auras.deepwounds4&&a.auras.deepwounds4.timer&&a.auras.deepwounds4.nexttick-step<l&&(l=a.auras.deepwounds4.nexttick-step),a.auras.potentvenoms2&&a.auras.potentvenoms2.timer&&a.auras.potentvenoms2.nexttick-step<l&&(l=a.auras.potentvenoms2.nexttick-step)),a.auras.weaponbleedmh&&a.auras.weaponbleedmh.timer&&a.auras.weaponbleedmh.interval-(step-a.auras.weaponbleedmh.starttimer)%a.auras.weaponbleedmh.interval<l&&(l=a.auras.weaponbleedmh.interval-(step-a.auras.weaponbleedmh.starttimer)%a.auras.weaponbleedmh.interval),a.auras.weaponbleedoh&&a.auras.weaponbleedoh.timer&&a.auras.weaponbleedoh.interval-(step-a.auras.weaponbleedoh.starttimer)%a.auras.weaponbleedoh.interval<l&&(l=a.auras.weaponbleedoh.interval-(step-a.auras.weaponbleedoh.starttimer)%a.auras.weaponbleedoh.interval),a.spells.bloodthirst&&a.spells.bloodthirst.timer&&a.spells.bloodthirst.timer<l&&(l=a.spells.bloodthirst.timer),a.spells.mortalstrike&&a.spells.mortalstrike.timer&&a.spells.mortalstrike.timer<l&&(l=a.spells.mortalstrike.timer),a.spells.shieldslam&&a.spells.shieldslam.timer&&a.spells.shieldslam.timer<l&&(l=a.spells.shieldslam.timer),a.spells.quickstrike&&a.spells.quickstrike.timer&&a.spells.quickstrike.timer<l&&(l=a.spells.quickstrike.timer),a.spells.ragingblow&&a.spells.ragingblow.timer&&a.spells.ragingblow.timer<l&&(l=a.spells.ragingblow.timer),a.spells.whirlwind&&a.spells.whirlwind.timer&&a.spells.whirlwind.timer<l&&(l=a.spells.whirlwind.timer),a.spells.shockwave&&a.spells.shockwave.timer&&a.spells.shockwave.timer<l&&(l=a.spells.shockwave.timer),a.spells.blademasterfury&&a.spells.blademasterfury.timer&&a.spells.blademasterfury.timer<l&&(l=a.spells.blademasterfury.timer),a.spells.bloodrage&&a.spells.bloodrage.timer&&a.spells.bloodrage.timer<l&&(l=a.spells.bloodrage.timer),a.spells.ragepotion&&a.spells.ragepotion.timer&&a.spells.ragepotion.timer<l&&(l=a.spells.ragepotion.timer),a.spells.overpower&&a.spells.overpower.timer&&a.spells.overpower.timer<l&&(l=a.spells.overpower.timer),a.spells.execute&&a.spells.execute.timer&&a.spells.execute.timer<l&&(l=a.spells.execute.timer),a.spells.slam&&a.spells.slam.timer&&a.spells.slam.timer<l&&(l=a.spells.slam.timer),a.auras.zerkforecast&&a.auras.zerkforecast.timer&&a.auras.zerkforecast.timer-step<l&&(l=a.auras.zerkforecast.timer-step),a.auras.battleforecast&&a.auras.battleforecast.timer&&a.auras.battleforecast.timer-step<l&&(l=a.auras.battleforecast.timer-step),a.auras.defforecast&&a.auras.defforecast.timer&&a.auras.defforecast.timer-step<l&&(l=a.auras.defforecast.timer-step),a.auras.gladforecast&&a.auras.gladforecast.timer&&a.auras.gladforecast.timer-step<l&&(l=a.auras.gladforecast.timer-step),a.auras.echoeszerk&&a.auras.echoeszerk.timer&&a.auras.echoeszerk.timer-step<l&&(l=a.auras.echoeszerk.timer-step),a.auras.echoesbattle&&a.auras.echoesbattle.timer&&a.auras.echoesbattle.timer-step<l&&(l=a.auras.echoesbattle.timer-step),a.auras.echoesdef&&a.auras.echoesdef.timer&&a.auras.echoesdef.timer-step<l&&(l=a.auras.echoesdef.timer-step),a.auras.echoesglad&&a.auras.echoesglad.timer&&a.auras.echoesglad.timer-step<l&&(l=a.auras.echoesglad.timer-step),!a.spells.execute||step<this.executestep&&(!a.auras.suddendeath||!a.auras.suddendeath.timer))if(a.spells.heroicstrike&&a.spells.heroicstrike.unqueue){let e=Math.max(a.mh.timer-a.spells.heroicstrike.unqueuetimer);e>0&&e<l&&(l=e)}else if(a.spells.cleave&&a.spells.cleave.unqueue){let e=Math.max(a.mh.timer-a.spells.cleave.unqueuetimer);e>0&&e<l&&(l=e)}if((step+=l)>this.maxsteps)break;a.mh.step(l),a.oh&&a.oh.step(l),r=!1,a.timer&&a.steptimer(l)&&!a.spelldelay&&(t=!0,r=a.spellqueueing),a.itemtimer&&a.stepitemtimer(l)&&!a.spelldelay&&(t=!0),a.stancetimer&&a.stepstancetimer(l)&&!a.spelldelay&&(t=!0),a.ragetimer&&a.stepragetimer(l),a.dodgetimer&&a.stepdodgetimer(l),a.spelldelay&&(a.spelldelay+=l),a.heroicdelay&&(a.heroicdelay+=l),a.spells.ragingblow&&a.spells.ragingblow.timer&&!a.spells.ragingblow.step(l)&&!a.spelldelay&&(t=!0),a.spells.berserkerrage&&a.spells.berserkerrage.timer&&!a.spells.berserkerrage.step(l)&&!a.spelldelay&&(t=!0),a.spells.bloodthirst&&a.spells.bloodthirst.timer&&!a.spells.bloodthirst.step(l)&&!a.spelldelay&&(t=!0),a.spells.mortalstrike&&a.spells.mortalstrike.timer&&!a.spells.mortalstrike.step(l)&&!a.spelldelay&&(t=!0),a.spells.shieldslam&&a.spells.shieldslam.timer&&!a.spells.shieldslam.step(l)&&!a.spelldelay&&(t=!0),a.spells.quickstrike&&a.spells.quickstrike.timer&&!a.spells.quickstrike.step(l)&&!a.spelldelay&&(t=!0),a.spells.whirlwind&&a.spells.whirlwind.timer&&!a.spells.whirlwind.step(l)&&!a.spelldelay&&(t=!0),a.spells.shockwave&&a.spells.shockwave.timer&&!a.spells.shockwave.step(l)&&!a.spelldelay&&(t=!0),a.spells.blademasterfury&&a.spells.blademasterfury.timer&&!a.spells.blademasterfury.step(l)&&!a.spelldelay&&(t=!0),a.spells.bloodrage&&a.spells.bloodrage.timer&&!a.spells.bloodrage.step(l)&&!a.spelldelay&&(t=!0),a.spells.ragepotion&&a.spells.ragepotion.timer&&!a.spells.ragepotion.step(l)&&!a.spelldelay&&(t=!0),a.spells.overpower&&a.spells.overpower.timer&&!a.spells.overpower.step(l)&&!a.spelldelay&&(t=!0),a.spells.execute&&a.spells.execute.timer&&!a.spells.execute.step(l)&&!a.spelldelay&&(t=!0),a.spells.hamstring&&a.spells.hamstring.timer&&!a.spells.hamstring.step(l)&&!a.spelldelay&&(t=!0),a.spells.pummel&&a.spells.pummel.timer&&!a.spells.pummel.step(l)&&!a.spelldelay&&(t=!0),a.spells.thunderclap&&a.spells.thunderclap.timer&&!a.spells.thunderclap.step(l)&&!a.spelldelay&&(t=!0),a.spells.sunderarmor&&a.spells.sunderarmor.timer&&!a.spells.sunderarmor.step(l)&&!a.spelldelay&&(t=!0),a.spells.slam&&a.spells.slam.timer&&!a.spells.slam.step(l)&&!a.spelldelay&&(t=!0),a.auras.bloodrage&&a.auras.bloodrage.timer&&!a.auras.bloodrage.step()&&!a.spelldelay&&(t=!0),a.auras.gabbar&&a.auras.gabbar.timer&&a.auras.gabbar.step(),a.auras.rend&&a.auras.rend.timer&&!a.auras.rend.step()&&!a.spelldelay&&(t=!0),a.auras.deepwounds&&a.auras.deepwounds.timer&&!a.auras.deepwounds.step()&&!a.spelldelay&&(t=!0),a.auras.potentvenoms&&a.auras.potentvenoms.timer&&!a.auras.potentvenoms.step()&&!a.spelldelay&&(t=!0),a.auras.weaponbleedmh&&a.auras.weaponbleedmh.timer&&!a.auras.weaponbleedmh.step()&&!a.spelldelay&&(t=!0),a.auras.weaponbleedoh&&a.auras.weaponbleedoh.timer&&!a.auras.weaponbleedoh.step()&&!a.spelldelay&&(t=!0),a.adjacent&&(a.auras.deepwounds2&&a.auras.deepwounds2.timer&&!a.auras.deepwounds2.step()&&!a.spelldelay&&(t=!0),a.auras.deepwounds3&&a.auras.deepwounds3.timer&&!a.auras.deepwounds3.step()&&!a.spelldelay&&(t=!0),a.auras.deepwounds4&&a.auras.deepwounds4.timer&&!a.auras.deepwounds4.step()&&!a.spelldelay&&(t=!0),a.auras.potentvenoms2&&a.auras.potentvenoms2.timer&&!a.auras.potentvenoms2.step()&&!a.spelldelay&&(t=!0)),a.auras.zerkforecast&&a.auras.zerkforecast.timer&&!a.auras.zerkforecast.step()&&!a.spelldelay&&(t=!0),a.auras.battleforecast&&a.auras.battleforecast.timer&&!a.auras.battleforecast.step()&&!a.spelldelay&&(t=!0),a.auras.defforecast&&a.auras.defforecast.timer&&!a.auras.defforecast.step()&&!a.spelldelay&&(t=!0),a.auras.gladforecast&&a.auras.gladforecast.timer&&!a.auras.gladforecast.step()&&!a.spelldelay&&(t=!0),a.auras.echoeszerk&&a.auras.echoeszerk.timer&&!a.auras.echoeszerk.step()&&!a.spelldelay&&(t=!0),a.auras.echoesbattle&&a.auras.echoesbattle.timer&&!a.auras.echoesbattle.step()&&!a.spelldelay&&(t=!0),a.auras.echoesdef&&a.auras.echoesdef.timer&&!a.auras.echoesdef.step()&&!a.spelldelay&&(t=!0),a.auras.echoesglad&&a.auras.echoesglad.timer&&!a.auras.echoesglad.step()&&!a.spelldelay&&(t=!0)}a.endauras(),a.logging=!1,a.auras.deepwounds&&(this.idmg+=a.auras.deepwounds.idmg),a.auras.deepwounds2&&(this.idmg+=a.auras.deepwounds2.idmg),a.auras.deepwounds3&&(this.idmg+=a.auras.deepwounds3.idmg),a.auras.deepwounds4&&(this.idmg+=a.auras.deepwounds4.idmg),a.auras.potentvenoms&&(this.idmg+=a.auras.potentvenoms.idmg),a.auras.potentvenoms2&&(this.idmg+=a.auras.potentvenoms2.idmg),a.auras.rend&&(this.idmg+=a.auras.rend.idmg),a.auras.weaponbleedmh&&(this.idmg+=a.auras.weaponbleedmh.idmg),a.auras.weaponbleedoh&&(this.idmg+=a.auras.weaponbleedoh.idmg),a.spells.fireball&&(this.idmg+=a.spells.fireball.idmg),a.spells.gunaxe&&(this.idmg+=a.spells.gunaxe.idmg),a.spells.themoltencore&&(this.idmg+=a.spells.themoltencore.idmg),this.totaldmg+=this.idmg,this.totalduration+=this.duration;let d=this.idmg/this.duration;d<this.mindps&&(this.mindps=d),d>this.maxdps&&(this.maxdps=d),this.sumdps+=d,this.sumdps2+=d*d,d=Math.round(d),this.spread[d]?this.spread[d]++:this.spread[d]=1}update(e){this.cb_update&&this.cb_update(e,{iterations:this.iterations,totaldmg:this.totaldmg,totalduration:this.totalduration})}finished(){this.cb_finished&&this.cb_finished({iterations:this.iterations,totaldmg:this.totaldmg,totalduration:this.totalduration,mindps:this.mindps,maxdps:this.maxdps,sumdps:this.sumdps,sumdps2:this.sumdps2,starttime:this.starttime,endtime:this.endtime})}}function rng(e,s){return~~(Math.random()*(s-e+1)+e)}function rng10k(){return~~(1e4*Math.random())}function avg(e,s){return(e+s)/2}