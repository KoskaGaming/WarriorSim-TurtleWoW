var SIM=SIM||{};SIM.PROFILES={init:function(){this.variables(),this.events(),this.buildProfiles()},variables:function(){this.body=$("body"),this.section=this.body.find("section.profiles"),this.container=this.section.find(".container"),this.presets=this.section.find(".presets"),this.close=this.section.find(".btn-close"),this.modal=this.body.find(".import-modal"),this.textarea=this.modal.find("textarea")},events:function(){var e=this;e.close.click(function(i){i.preventDefault(),$(".js-profiles").removeClass("active"),e.section.removeClass("active"),e.body.addClass("sidebar-mobile-open")}),e.container.on("click",".profile",function(i){i.preventDefault();let t=$(this);e.loadProfile(t),e.close.click()}),e.container.on("click",".add-profile",function(i){i.preventDefault(),e.addProfile($(this).parent().prev().data("index")+1)}),e.container.on("click",".import-profile",function(i){i.preventDefault(),e.modal.addClass("open"),e.textarea.focus()}),e.presets.on("click",".import-th",function(i){i.preventDefault(),i.stopPropagation();let t=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_th,t)}),e.presets.on("click",".import-dw",function(i){i.preventDefault(),i.stopPropagation();let t=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_dw,t)}),e.presets.on("click",".import-thmc",function(i){i.preventDefault(),i.stopPropagation();let t=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_thmc,t)}),e.presets.on("click",".import-dwmc",function(i){i.preventDefault(),i.stopPropagation();let t=e.container.find(".profile").last().data("index")+1;e.importProfile(preset_dwmc,t)}),e.container.on("click",".delete-profile",function(i){i.preventDefault(),i.stopPropagation(),e.deleteProfile($(this).parents(".profile"))}),e.container.on("click",".profile input",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("edit")}),e.container.on("keyup",".profile input",function(e){if("Enter"==e.key){$(this).removeClass("edit");let e=$(this).val(),i=$(this).parents(".profile"),t=i.data("index"),o=JSON.parse(localStorage[mode+t]);o.profilename=e,localStorage[mode+t]=JSON.stringify(o),i.hasClass("active")&&(globalThis.profilename=e),$(this).blur(),SIM.UI.updateSession()}}),e.container.on("click",".edit-profilename",function(e){e.preventDefault(),e.stopPropagation(),$(this).siblings("input").addClass("edit")}),e.container.on("click",".export-profile",function(i){i.preventDefault(),i.stopPropagation(),e.exportProfile($(this).parents(".profile"))}),e.modal.find(".btn-close").click(function(i){i.preventDefault(),e.modal.removeClass("open")}),e.textarea.on("input",function(i){let t=$(this).val();if(t&&t.length>20){let i=e.container.find(".profile").last().data("index")+1;e.importProfile(t,i),e.modal.removeClass("open"),$(this).val("")}})},deleteProfile(e){let i=e.data("index");delete localStorage[mode+i];let t=0;for(let e=0;e<40;e++)localStorage[mode+e]&&(localStorage[mode+t]=localStorage[mode+e],t!=e&&delete localStorage[mode+e],t++);globalThis.profileid==i&&(globalThis.profileid=0),this.buildProfiles(),SIM.UI.addAlert("Profile deleted")},addProfile(e){let i=mode+e,t=mode+(globalThis.profileid||0);if(void 0===localStorage[i]){localStorage[i]=localStorage[t];let o=JSON.parse(localStorage[i]);o.profilename="Profile "+(e+1),localStorage[i]=JSON.stringify(o)}this.buildProfiles()},loadProfile(e){var i=e.data("index");let t=mode+i,o=mode+(globalThis.profileid||0);globalThis.profileid=i,void 0===localStorage[t]&&(localStorage[t]=localStorage[o]),SIM.UI.loadSession(),SIM.UI.updateSidebar(),SIM.SETTINGS.buildSpells(),SIM.SETTINGS.buildBuffs(),SIM.SETTINGS.buildTalents(),SIM.SETTINGS.buildRunes(),this.body.find("nav > ul > li.active > p").click();let a=JSON.parse(localStorage[t]);SIM.UI.addAlert(`${a.profilename} loaded`),e.addClass("active"),e.siblings().removeClass("active")},buildProfiles(){const e=this;e.container.empty();let i=globalThis.profileid||0,t=0,o=Object.keys(localStorage).filter(e=>e.indexOf(mode)>-1).length;do{if(!localStorage[mode+t])continue;if("undefined"===localStorage[mode+t]){delete localStorage[mode+t];continue}let a=JSON.parse(localStorage[mode+t]),r=e.getItemsHTML(a),s=e.getTalents(a),l=$(`\n                <div data-index="${t}" class="profile ${i==t?"active":""}">\n                    <div class="title"><input name="profilename" type="text" value="${a.profilename}" /><div class="edit-profilename">${svgPencil}</div></div>\n                    <p>${a.race} level ${a.level}</p>\n                    <p></p>\n                    <p>${s}</p>\n                    <ul>${r}</ul>\n                    <div class="export-profile" title="Export">${svgExport}</div>\n                    ${o>1?`<div class="delete-profile" title="Delete">${svgThrash}</div>`:""}\n                </div>`);e.container.append(l)}while(t++<40);e.container.append(`<div>\n            <div class="add-profile">${svgAdd}<p>Add Profile</p></div>\n            <div class="import-profile">${svgImport}<p>Import Profile</p></div>\n            </div>`),"turtle"==mode&&(e.presets.empty(),e.presets.append('\n                <label>Presets:</label>\n                <div class="import-th">DW Fury Bis vs Boss (60 sec, Single Target)</div>'))},getItemsHTML(e){const i=this;let t="";for(let o in e.gear)if("twohand"==o||"mainhand"==o||"offhand"==o)for(let a of e.gear[o])if(a.selected){let o=i.getItem(a.id);o&&(t+=i.getItemHTML(o,e))}for(let o in e.gear)if("custom"!=o&&"twohand"!=o&&"mainhand"!=o&&"offhand"!=o)for(let a of e.gear[o])if(a.selected){let o=i.getItem(a.id);o&&(t+=i.getItemHTML(o,e))}return t},getItemHTML(e,i){let t="";if(void 0!==i.runes&&i.runes[e.slot])for(let o of i.runes[e.slot])if(o.selected){let i=runes[e.slot].filter(e=>e.id==o.id)[0];i?t=`<img src="https://wow.zamimg.com/images/wow/icons/medium/${i.iconname}.jpg">`:o.selected=!1}return`<li data-quality="${e.q}"><p>${e.name}</p> ${t}</li>`},getItem(e){for(let i in gear)for(let t of gear[i])if(t.id==e)return t},getTalents:e=>`${e.talents[0].t.reduce((e,i)=>e+i,0)} / ${e.talents[1].t.reduce((e,i)=>e+i,0)} / ${e.talents[2].t.reduce((e,i)=>e+i,0)}`,exportProfile:function(e){let i=e.data("index"),t=JSON.parse(localStorage[mode+i]),o={};for(let e in t)"string"==typeof t[e]&&(o[e]=t[e]);o.buffs=t.buffs,o.talents=t.talents,o.gear={};for(let e in t.gear)for(let i of t.gear[e])i.selected&&(o.gear[e]=i.id);o.rotation=[];for(let e of t.rotation)if(e.active){let i={};i.id=e.id,void 0!==e.duration&&(i.duration=e.duration),void 0!==e.durationactive&&(i.durationactive=e.durationactive),void 0!==e.timetoend&&(i.timetoend=e.timetoend),void 0!==e.timetoendactive&&(i.timetoendactive=e.timetoendactive),void 0!==e.timetostart&&(i.timetostart=e.timetostart),void 0!==e.timetostartactive&&(i.timetostartactive=e.timetostartactive),void 0!==e.crusaders&&(i.crusaders=e.crusaders),void 0!==e.haste&&(i.haste=e.haste),void 0!==e.procblock&&(i.procblock=e.procblock),void 0!==e.rageblock&&(i.rageblock=e.rageblock),void 0!==e.rageblockactive&&(i.rageblockactive=e.rageblockactive),void 0!==e.minrage&&(i.minrage=e.minrage),void 0!==e.minrageactive&&(i.minrageactive=e.minrageactive),void 0!==e.maxrage&&(i.maxrage=e.maxrage),void 0!==e.maxrageactive&&(i.maxrageactive=e.maxrageactive),void 0!==e.maincd&&(i.maincd=e.maincd),void 0!==e.maincdactive&&(i.maincdactive=e.maincdactive),void 0!==e.priorityap&&(i.priorityap=e.priorityap),void 0!==e.priorityapactive&&(i.priorityapactive=e.priorityapactive),void 0!==e.unqueue&&(i.unqueue=e.unqueue),void 0!==e.unqueueactive&&(i.unqueueactive=e.unqueueactive),void 0!==e.exmacro&&(i.exmacro=e.exmacro),void 0!==e.decisive&&(i.decisive=e.decisive),void 0!==e.globals&&(i.globals=e.globals),void 0!==e.globalsactive&&(i.globalsactive=e.globalsactive),void 0!==e.swingreset&&(i.swingreset=e.swingreset),void 0!==e.afterswing&&(i.afterswing=e.afterswing),void 0!==e.alwaystails&&(i.alwaystails=e.alwaystails),void 0!==e.alwaysheads&&(i.alwaysheads=e.alwaysheads),void 0!==e.zerkerpriority&&(i.zerkerpriority=e.zerkerpriority),void 0!==e.swordboard&&(i.swordboard=e.swordboard),void 0!==e.resolve&&(i.resolve=e.resolve),void 0!==e.switchstart&&(i.switchstart=e.switchstart),void 0!==e.switchtime&&(i.switchtime=e.switchtime),void 0!==e.switchrage&&(i.switchrage=e.switchrage),void 0!==e.switchdefault&&(i.switchdefault=e.switchdefault),void 0!==e.switchtimeactive&&(i.switchtimeactive=e.switchtimeactive),void 0!==e.swingtimeractive&&(i.swingtimeractive=e.swingtimeractive),void 0!==e.swingtimer&&(i.swingtimer=e.swingtimer),void 0!==e.priority&&(i.priority=e.priority),void 0!==e.expriority&&(i.expriority=e.expriority),void 0!==e.switchechoesactive&&(i.switchechoesactive=e.switchechoesactive),void 0!==e.switchechoestime&&(i.switchechoestime=e.switchechoestime),void 0!==e.switchechoesrage&&(i.switchechoesrage=e.switchechoesrage),void 0!==e.switchoractive&&(i.switchoractive=e.switchoractive),void 0!==e.switchortime&&(i.switchortime=e.switchortime),void 0!==e.switchorrage&&(i.switchorrage=e.switchorrage),void 0!==e.secondarystance&&(i.secondarystance=e.secondarystance),o.rotation.push(i)}o.runes={};for(let e in t.runes)for(let i of t.runes[e])i.selected&&(o.runes[e]=i.id);o.enchant={};for(let e in t.enchant)for(let i of t.enchant[e])i.selected&&(o.enchant[e]||(o.enchant[e]=[]),o.enchant[e].push(i.id));let a=btoa(JSON.stringify(o));navigator.clipboard.writeText(a),SIM.UI.addAlert("Profile copied to clipboard")},importProfile(e,i){const t=this;try{let o="{"==e[0]?JSON.parse(e.trim()):JSON.parse(atob(e.trim()));localStorage[mode+(globalThis.profileid||0)]||SIM.UI.loadSession();let a=JSON.parse(localStorage[mode+(globalThis.profileid||0)]);for(let e in o)"string"==typeof o[e]&&(a[e]=o[e]);a.buffs=o.buffs,a.talents=o.talents,a.gear={};for(let e in o.gear)"custom"!=e&&(a.gear[e]=[{id:o.gear[e],selected:!0}]);for(let e of spells)a.rotation.filter(i=>i.id==e.id).length||a.rotation.push(e);for(let e of a.rotation){let i=o.rotation.filter(i=>i.id==e.id)[0];i?(e.active=!0,void 0!==i.duration&&(e.duration=i.duration),void 0!==i.durationactive&&(e.durationactive=i.durationactive),void 0!==i.timetoend&&(e.timetoend=i.timetoend),void 0!==i.timetoendactive&&(e.timetoendactive=i.timetoendactive),void 0!==i.timetostart&&(e.timetostart=i.timetostart),void 0!==i.timetostartactive&&(e.timetostartactive=i.timetostartactive),void 0!==i.crusaders&&(e.crusaders=i.crusaders),void 0!==i.haste&&(e.haste=i.haste),void 0!==i.procblock&&(e.procblock=i.procblock),void 0!==i.rageblock&&(e.rageblock=i.rageblock),void 0!==i.rageblockactive&&(e.rageblockactive=i.rageblockactive),void 0!==i.minrage&&(e.minrage=i.minrage),void 0!==i.minrageactive&&(e.minrageactive=i.minrageactive),void 0!==i.maxrage&&(e.maxrage=i.maxrage),void 0!==i.maxrageactive&&(e.maxrageactive=i.maxrageactive),void 0!==i.maincd&&(e.maincd=i.maincd),void 0!==i.maincdactive&&(e.maincdactive=i.maincdactive),void 0!==i.priorityap&&(e.priorityap=i.priorityap),void 0!==i.priorityapactive&&(e.priorityapactive=i.priorityapactive),void 0!==i.unqueue&&(e.unqueue=i.unqueue),void 0!==i.unqueueactive&&(e.unqueueactive=i.unqueueactive),void 0!==i.exmacro&&(e.exmacro=i.exmacro),void 0!==i.decisive&&(e.decisive=i.decisive),void 0!==i.globals&&(e.globals=i.globals),void 0!==i.globalsactive&&(e.globalsactive=i.globalsactive),void 0!==i.afterswing&&(e.afterswing=i.afterswing),void 0!==i.swingreset&&(e.swingreset=i.swingreset),void 0!==i.alwaystails&&(e.alwaystails=i.alwaystails),void 0!==i.alwaysheads&&(e.alwaysheads=i.alwaysheads),void 0!==i.zerkerpriority&&(e.zerkerpriority=i.zerkerpriority),void 0!==i.swordboard&&(e.swordboard=i.swordboard),void 0!==i.resolve&&(e.resolve=i.resolve),void 0!==i.switchstart&&(e.switchstart=i.switchstart),void 0!==i.switchtime&&(e.switchtime=i.switchtime),void 0!==i.switchrage&&(e.switchrage=i.switchrage),void 0!==i.switchdefault&&(e.switchdefault=i.switchdefault),void 0!==i.switchtimeactive&&(e.switchtimeactive=i.switchtimeactive),void 0!==i.swingtimeractive&&(e.swingtimeractive=i.swingtimeractive),void 0!==i.swingtimer&&(e.swingtimer=i.swingtimer),void 0!==i.priority&&(e.priority=i.priority),void 0!==i.expriority&&(e.expriority=i.expriority),void 0!==i.switchechoesactive&&(e.switchechoesactive=i.switchechoesactive),void 0!==i.switchechoestime&&(e.switchechoestime=i.switchechoestime),void 0!==i.switchechoesrage&&(e.switchechoesrage=i.switchechoesrage),void 0!==i.switchoractive&&(e.switchoractive=i.switchoractive),void 0!==i.switchortime&&(e.switchortime=i.switchortime),void 0!==i.switchorrage&&(e.switchorrage=i.switchorrage),void 0!==i.secondarystance&&(e.secondarystance=i.secondarystance)):e.active=!1}a.runes={};for(let e in o.runes)a.runes[e]=[{id:o.runes[e],selected:!0}];a.enchant={};for(let e in o.enchant){a.enchant[e]=[];for(let i of o.enchant[e])a.enchant[e].push({id:i,selected:!0})}let r=mode+(i||0);localStorage[r]=JSON.stringify(a),t.buildProfiles(),SIM.UI.addAlert(a.profilename+" imported")}catch(e){SIM.UI.addAlert("Invalid profile")}}};const svgImport='<svg width="24"height="24"viewBox="0 0 24 24"fill="none"xmlns="http://www.w3.org/2000/svg"><path  d="M5 9.98193V19.9819H19V9.98193H15V7.98193H21V21.9819H3V7.98193H9V9.98193H5Z" fill="currentColor"/><path  d="M13.0001 2H11.0001V14.0531L8.46451 11.5175L7.05029 12.9317L12 17.8815L16.9498 12.9317L15.5356 11.5175L13.0001 14.053V2Z" fill="currentColor"/></svg>',svgExport='<svg width="24"height="24"viewBox="0 0 24 24"fill="none"xmlns="http://www.w3.org/2000/svg"><path  d="M16.9498 5.96781L15.5356 7.38203L13 4.84646V17.0421H11V4.84653L8.46451 7.38203L7.05029 5.96781L12 1.01807L16.9498 5.96781Z"  fill="currentColor"/><path  d="M5 20.9819V10.9819H9V8.98193H3V22.9819H21V8.98193H15V10.9819H19V20.9819H5Z"  fill="currentColor"/></svg>',svgPencil='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16"><path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/></svg>',svgThrash='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/></svg>',svgAdd='<svg width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  xmlns="http://www.w3.org/2000/svg">  <path    d="M12 4C11.4477 4 11 4.44772 11 5V11H5C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13H11V19C11 19.5523 11.4477 20 12 20C12.5523 20 13 19.5523 13 19V13H19C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11H13V5C13 4.44772 12.5523 4 12 4Z" fill="currentColor"  /></svg>';